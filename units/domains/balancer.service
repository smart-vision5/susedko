[Unit]
Description=Load Balancer Server
Wants=network-online.target

[Service]
User=domains
Group=domains
Restart=on-failure
Environment=REGISTRY_AUTH_FILE="/usr/local/etc/docker-auth.json"
ExecStartPre=-/bin/podman kill balancer
ExecStartPre=-/bin/podman rm balancer
ExecStartPre=/bin/podman pull docker.io/nginxinc/nginx-unprivileged:1-alpine
ExecStart=/bin/podman run \
          --read-only \
          --network host \
          -p 8080:8080 \
          -p 8443:8443 \
          -v /usr/local/etc/ssl/:/usr/local/etc/ssl/:ro \
          -v /usr/local/etc/nginx/:/usr/local/etc/nginx/:ro \
          -v /usr/local/etc/nginx/conf.d/:/etc/nginx/conf.d/:ro \
          --name balancer \
          --label "io.containers.autoupdate=image" \
          docker.io/nginxinc/nginx-unprivileged:1-alpine
ExecStop=/bin/podman stop -t 10 status

[Install]
WantedBy=multi-user.target
